Data transfer from the Sharp PC-1401 with the ROM function "Device Select"

This program transfers a byte from the Sharp Pocket Computer PC-1401 to an Arduino UNO using the ROM routine "Device-Select" (&A870).
In this way, the programming effort for the pocket computer can be kept to a minimum.
In order for the data transmission to run stably, it is necessary to switch pull-down resistors (eg 10kOhm) from the data and control lines (except Xout) to GND.
The Arduino program is a somewhat simplified version of the printer emulator (version for PC-1401, PC-1403, PC-E500) for the CE-126P.
Since in this case only the information (Dout) transmitted during the "Device Select" process (with Xout=HIGH) can be used,
the reading of the data byte (with Xout=LOW) would not be absolutely necessary for this Arduino program.
It is done anyway to avoid the Sharp PC getting stuck in an undefined state.


Breadboard with Arduino UNO:



BASIC program for Sharp PC-1401:


10:POKE &4100,2,0,120,&A8,&70,&EB,&38,55
20:INPUT "0-255:";X
30:POKE &4101,X
40:CALL &4100
50:GOTO 20

Assembler representation of the machine program
&4100: 	002 	000 	  	LIA 	0 	  	  	  	The content of address &4101 is transferred to the A register (accumulator).
&4102: 	120 	&A8 	&70    	CALL 	&A870   	  	  	  	The content of the A register (battery) is transferred to the Fo2 port (Dout) with the "Device Select" function
&4105: 	&EB 	&38 	  	CAL 	&B38 	  	  	  	Ports are being reset
&4107: 	055 	  	  	RTN 	  	  	  	  	Return to the basics



Arduino UNO program:

// Transmission of "Device Select" and data bytes to the Arduino UNO

const  int  OUT_ACK9  =  4 ;  // Pin D4, ACK, pin 9 of the 11-pin. Socket strip 
const  int  IN_Xout7  =  6 ;  // Pin D6, Xout, pin 7 of the 11-pin. Socket strip 
const  int  IN_Dout5  =  8 ;  // Pin D8, Dout, pin 5 of the 11-pin. Socket strip 
const  int  IN_Busy4  =  9 ;  // Pin D9, Busy, pin 4 of the 11-pin. socket strip 
int  DataBit ; 
int  DataByte ; 
int  i ;

void  setup ( )  { 
  Serial . begin ( 9600 ) ; 
  pinMode ( OUT_ACK9 ,  OUTPUT ) ; 
  pinMode ( IN_Xout7 ,  INPUT ) ; 
  pinMode ( IN_Dout5 ,  INPUT ) ; 
  pinMode ( IN_Busy4 ,  INPUT ) ; 
  serial . println ( ) ; 
  serial . println ( "Ready:" ) ;
  serial . println ( ) ; 
}

void  loop ( )  { 
  if  ( digitalRead ( IN_Xout7 ) )  {  // Transmission of DeviceSelect 
    i  =  0 ; 
    DataByte  =  0 ; 
    do  { 
      digitalWrite ( OUT_ACK9 ,  HIGH ) ; 
      while  ( ! digitalRead ( IN_Busy4 ) ) ; 
      DataBit  =  digitalRead ( IN_Dout5 ) ; 
      digitalWrite ( OUT_ACK9 , LOW ) ; 
      while  ( digitalRead ( IN_Busy4 ) ) ; 
      DataByte  =  DataByte  |  ( DataBit  <<  i ) ; 
      i ++ ; 
    }  while  ( i  <  8 ) ; 
    while  ( digitalRead ( IN_Xout7 ) ) ; 
    digitalWrite ( OUT_ACK9 ,  HIGH ) ; 
    delayMicroseconds ( 400 ) ;
    digitalWrite ( OUT_ACK9 ,  LOW ) ; 
    serial . print ( "DeviceSelect:" ) ; 
    serial . println ( DataByte ) ; 
  }

  if  ( digitalRead ( IN_Busy4 )  &&  ! digitalRead ( IN_Xout7 ) )  {  // Transmission of a data byte 
    i  =  0 ; 
    DataByte  =  0 ; 
    do  { 
      while  ( ! digitalRead ( IN_Busy4 ) ) ; 
      DataBit  =  digitalRead ( IN_Dout5 ) ; 
      digitalWrite ( OUT_ACK9 ,  HIGH ) ; 
      while  (digitalRead ( IN_Busy4 ) ) ; 
      digitalWrite ( OUT_ACK9 ,  LOW ) ; 
      DataByte  =  DataByte  |  ( DataBit  <<  i ) ; 
      i ++ ; 
    }  while  ( i  <  8 ) ; 
    serial . println ( DataByte ) ; 
  }
  
}  // end loop


pinout 	Signal course when the value 15 is transmitted
Arduino UNO pin 	Surname 	Sharp PC 11-pin
interface 	
GND 	GND 	pins 3
D9 (input) 	busy 	pins 4
D8 (input) 	dout 	pins 5
D6 (input) 	Xout 	pins 7
D4 (output) 	ACK 	pins 9

